<%- include('include/header') %>
<%- include('include/sidebar') %>

<div class="p-6 bg-[#0f172a] min-h-screen text-white">
  <h1 class="text-3xl font-bold mb-8">üöÄ Affiliate Dashboard</h1>

  <!-- Metrics -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-10">

    <!-- Commission Rate -->
    <div class="bg-gradient-to-br from-green-500/10 to-green-500/5 p-5 rounded-2xl shadow-xl border border-green-700/30">
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-sm text-gray-400 font-medium uppercase tracking-wide">Commission Rate</h2>
        <i class="fas fa-pen text-green-400 text-sm cursor-pointer"></i>
      </div>
      <div class="text-4xl font-bold text-white mb-2">‚Çπ100</div>
      <div class="text-sm text-gray-400">
        Affiliate Code: <span class="text-white font-medium"><%= user && user.referral_code ? user.referral_code : '' %></span>

      </div>
    </div>

    <!-- Lifetime Earnings -->
    <div class="bg-gradient-to-br from-yellow-500/10 to-yellow-500/5 p-5 rounded-2xl shadow-xl border border-yellow-700/30">
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-sm text-gray-400 font-medium uppercase tracking-wide">Lifetime Earnings</h2>
        <i class="fas fa-coins text-yellow-400 text-lg"></i>
      </div>
      <div class="text-4xl font-bold text-white mb-2">‚Çπ<%= earnings.toFixed(2) %></div>
      <div class="text-sm text-gray-400">
        Last 7 Days: ‚Çπ<%= earningsLast7.toFixed(2) %><br />
        Last 30 Days: ‚Çπ<%= earningsLast30.toFixed(2) %>
      </div>
    </div>

    <!-- Users Referred -->
    <div class="bg-gradient-to-br from-cyan-500/10 to-cyan-500/5 p-5 rounded-2xl shadow-xl border border-cyan-700/30">
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-sm text-gray-400 font-medium uppercase tracking-wide">Users Referred</h2>
        <i class="fas fa-users text-cyan-400 text-lg"></i>
      </div>
      <div class="text-4xl font-bold text-white mb-2"><%= referredUsers.length %></div>
      <div class="text-sm text-gray-400">
        Last 7 Days: <%= earningsLast7 / 100 %><br />
        Last 30 Days: <%= earningsLast30 / 100 %>
      </div>
    </div>
  </div>

  <!-- Referred Users List -->
  <div class="bg-[#1e293b] rounded-2xl p-6 shadow-xl">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-semibold text-white">üë• Referred Users</h2>
    </div>

    <% if (referredUsers.length > 0) { %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-700 text-sm">
          <thead class="text-gray-400 uppercase text-xs bg-[#334155]">
            <tr>
              <th class="py-3 px-4 text-left">Name</th>
              <th class="py-3 px-4 text-left">Email</th>
              <th class="py-3 px-4 text-left">Joined At</th>
            </tr>
          </thead>
          <tbody class="text-white divide-y divide-gray-700">
            <% referredUsers.forEach(user => { %>
              <tr class="hover:bg-gray-800/40 transition">
                <td class="py-4 px-4 font-semibold"><%= user.full_name %></td>
                <td class="py-4 px-4"><%= user.email %></td>
                <td class="py-4 px-4"><%= new Date(user.created_at).toLocaleDateString('en-IN') %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p class="text-center text-gray-400 py-4">No users referred yet.</p>
    <% } %>

    <div class="mt-6 bg-[#0f172a] border border-blue-900/50 rounded-md p-4 text-sm text-blue-300">
    <div class="mt-6 bg-[#0f172a] border border-blue-900/50 rounded-md p-4 text-sm text-blue-300">
  <span class="font-semibold">‚ÑπÔ∏è Tip:</span> 
  Promote your link 
  <span 
    id="referralLink" 
    onclick="copyReferralLink()" 
    class="underline text-blue-400 hover:text-blue-300 cursor-pointer"
    title="Click to copy">
    https://profitnote.acutetech.in/signup?refer=<%= user && user.referral_code ? user.referral_code : '' %>
  </span> 
  to earn ‚Çπ100 per signup.
</div>

<script>
  function copyReferralLink() {
    const linkText = document.getElementById("referralLink").innerText;
    navigator.clipboard.writeText(linkText).then(() => {
      const originalText = document.getElementById("referralLink").innerText;
      document.getElementById("referralLink").innerText = "Copied!";
      setTimeout(() => {
        document.getElementById("referralLink").innerText = originalText;
      }, 1500);
    });
  }
</script>

    </div>
  </div>
</div>

<%- include('include/footer') %>
