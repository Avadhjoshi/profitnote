<%- include('../include/header') %>
<%- include('../include/sidebar') %>

<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-semibold">Reports</h1>
 <form method="GET" class="flex gap-2 items-center">
    <!-- Market -->
    <select name="market" onchange="this.form.submit()"
      class="bg-[#1e293b] border border-gray-700 text-sm px-3 py-1 rounded-md text-white">
      <% marketList.forEach(m => { %>
        <option value="<%= m.id %>" <%= market == m.id ? 'selected' : '' %>><%= m.market_name %></option>
      <% }) %>
    </select>

    <!-- Month -->
    <select name="month" onchange="this.form.submit()"
      class="bg-[#1e293b] border border-gray-700 text-sm px-3 py-1 rounded-md text-white">
      <% for (let m = 0; m < 12; m++) { %>
        <option value="<%= m %>" <%= month == m ? 'selected' : '' %>>
          <%= new Date(2000, m).toLocaleString('default', { month: 'long' }) %>
        </option>
      <% } %>
    </select>

    <!-- Year -->
    <select name="year" onchange="this.form.submit()"
      class="bg-[#1e293b] border border-gray-700 text-sm px-3 py-1 rounded-md text-white">
      <% for (let y = 2023; y <= 2030; y++) { %>
        <option value="<%= y %>" <%= year == y ? 'selected' : '' %>><%= y %></option>
      <% } %>
    </select>
  </form>


</div>


<div class="p-6 space-y-6 text-white">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">

  
    <!-- Trade Performance -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
      <div class="flex items-center justify-between mb-5">
        <h3 class="text-lg font-semibold text-white">Trade Performance</h3>
        <div class="bg-blue-600 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-md text-xl">
          <i class="fas fa-chart-line"></i>
        </div>
      </div>
      <div class="flex justify-center gap-6 text-3xl font-extrabold mb-3">
        <span class="text-green-400"><%= tradePerformance.win %></span>
        <span class="text-white">|</span>
        <span class="text-red-400"><%= tradePerformance.loss %></span>
        <span class="text-white">|</span>
        <span class="text-gray-300"><%= tradePerformance.breakeven %></span>
      </div>
      <p class="text-center text-sm text-gray-400 mb-6">Win | Loss | Break Even</p>
      <div class="grid grid-cols-2 gap-4 text-sm text-gray-200">
        <div><p class="text-gray-400">Avg Win</p><p class="text-green-400 font-medium"><%= currencySymbol %><%= tradePerformance.avgWin.toFixed(2) %></p></div>
        <div><p class="text-gray-400">Avg Loss</p><p class="text-red-400 font-medium"><%= currencySymbol %><%= tradePerformance.avgLoss.toFixed(2) %></p></div>
        <div><p class="text-gray-400">Win Rate</p><p class="text-white font-medium"><%= tradePerformance.winRate.toFixed(1) %>%</p></div>
        <div><p class="text-gray-400">Expectancy</p><p class="text-white font-medium"><%= currencySymbol %><%= tradePerformance.expectancy %></p></div>
      </div>
    </div>
    
    <!-- Daily Performance -->
<div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
  <div class="flex items-center justify-between mb-5">
    <h3 class="text-lg font-semibold text-white">Daily Performance</h3>
    <div class="bg-green-600 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-md text-xl">
      <i class="fas fa-calendar-day"></i>
    </div>
  </div>
  <div class="flex justify-center gap-6 text-3xl font-extrabold mb-3">
    <span class="text-green-400"><%= dailyPerformance.winDays %></span>
    <span class="text-white">|</span>
    <span class="text-red-400"><%= dailyPerformance.lossDays %></span>
    <span class="text-white">|</span>
    <span class="text-gray-300"><%= dailyPerformance.beDays %></span>
  </div>
  <p class="text-center text-sm text-gray-400 mb-6">Win | Loss | Break Even Days</p>
  <div class="grid grid-cols-2 gap-4 text-sm text-gray-200">
<div>
  <p class="text-gray-400">Best Day</p>
  <p class="text-green-400 font-medium">
    <%= currencySymbol %><%= Number(dailyPerformance.bestDay).toFixed(2) %>
  </p>
</div>
<div>
  <p class="text-gray-400">Worst Day</p>
  <p class="text-red-400 font-medium">
    <%= currencySymbol %><%= Number(dailyPerformance.worstDay).toFixed(2) %>
  </p>
</div>
    <div><p class="text-gray-400">Avg Win Day</p><p class="text-white"><%= currencySymbol %><%= dailyPerformance.avgWinDay %></p></div>
    <div><p class="text-gray-400">Avg Loss Day</p><p class="text-white"><%= currencySymbol %><%= dailyPerformance.avgLossDay %></p></div>
  </div>
</div>

<!-- Trade Execution -->
<div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
  <div class="flex items-center justify-between mb-5">
    <h3 class="text-lg font-semibold text-white">Trade Execution</h3>
    <div class="bg-purple-600 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-md text-xl">
      <i class="fas fa-play"></i>
    </div>
  </div>
  <ul class="space-y-3 text-sm text-gray-300">
    <li class="flex justify-between"><span>Total Trades</span><span class="text-white"><%= tradeExecution.totalTrades %></span></li>
    <li class="flex justify-between"><span>Avg Capital Used</span><span class="text-white"><%= currencySymbol %><%= tradeExecution.avgCapital.toFixed(2) %></span></li>
    <li class="flex justify-between"><span>Most Profitable Strategy</span><span class="text-white"><%= tradeExecution.mostProfitableStrategy %></span></li>
    <li class="flex justify-between"><span>Consecutive Wins</span><span class="text-green-400"><%= tradeExecution.consecutiveWins %></span></li>
    <li class="flex justify-between"><span>Consecutive Losses</span><span class="text-red-400"><%= tradeExecution.consecutiveLosses %></span></li>
  </ul>
</div>

<!-- Time Metrics -->
<div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
  <div class="flex items-center justify-between mb-5">
    <h3 class="text-lg font-semibold text-white">Time Metrics</h3>
    <div class="bg-yellow-500 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-md text-xl">
      <i class="fas fa-hourglass-half"></i>
    </div>
  </div>
  <ul class="space-y-3 text-sm text-gray-300">
    <li class="flex justify-between"><span>Trading Days</span><span class="text-white"><%= timeMetrics.tradingDays %></span></li>
    <li class="flex justify-between"><span>Consecutive Win Days</span><span class="text-green-400"><%= timeMetrics.consecutiveWinDays %></span></li>
    <li class="flex justify-between"><span>Consecutive Loss Days</span><span class="text-red-400"><%= timeMetrics.consecutiveLossDays %></span></li>
  </ul>
</div>

    <!-- Setup Effectiveness -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
      <div class="flex items-center justify-between mb-5">
        <h3 class="text-lg font-semibold text-white">Setup Effectiveness</h3>
        <div class="bg-green-500 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-md text-xl">
          <i class="fas fa-lightbulb"></i>
        </div>
      </div>
      <ul class="space-y-3 text-sm text-gray-300">
        <% strategyStats.forEach(stat => { %>
          <li class="flex justify-between">
            <span><%= stat.name %></span>
            <span class="text-white"><%= stat.winRate %>% win rate</span>
          </li>
        <% }) %>
      </ul>
    </div>

    <!-- Symbol Frequency -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
      <div class="flex items-center justify-between mb-5">
        <h3 class="text-lg font-semibold text-white">Symbol Frequency</h3>
        <div class="bg-indigo-600 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-md text-xl">
          <i class="fas fa-hashtag"></i>
        </div>
      </div>
      <% if (symbolFrequency.length === 0) { %>
        <p class="text-sm text-gray-500 italic">No data yet</p>
      <% } else { %>
        <ul class="text-sm space-y-1 text-white">
          <% symbolFrequency.forEach(sym => { %>
            <li class="flex justify-between">
              <span><%= sym.symbol %></span>
              <span><%= sym.count %> trades</span>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>

    <!-- Capital Usage -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Capital Usage</h3>
        <div class="bg-green-600 p-2 rounded-xl"><i class="fas fa-money-bill"></i></div>
      </div>
      <ul class="text-sm space-y-1">
        <li class="flex justify-between text-gray-300"><span>Maximum</span><span><%= currencySymbol %><%= capital.max %></span></li>
        <li class="flex justify-between text-gray-300"><span>Minimum</span><span><%= currencySymbol %><%= capital.min %></span></li>
        <li class="flex justify-between text-gray-300"><span>Average</span><span><%= currencySymbol %><%= capital.avg.toFixed(2) %></span></li>
        <li class="flex justify-between text-green-400"><span>P&L at Max Capital</span><span><%= currencySymbol %><%= capital.pnlMax %></span></li>
        <li class="flex justify-between text-green-400"><span>P&L at Min Capital</span><span><%= currencySymbol %><%= capital.pnlMin %></span></li>
      </ul>
    </div>

    <!-- Quantity Analysis -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Quantity Analysis</h3>
        <div class="bg-yellow-600 p-2 rounded-xl"><i class="fas fa-crown"></i></div>
      </div>
      <ul class="text-sm space-y-1">
        <li class="flex justify-between text-gray-300"><span>Maximum</span><span><%= quantity.max %></span></li>
        <li class="flex justify-between text-gray-300"><span>Minimum</span><span><%= quantity.min %></span></li>
        <li class="flex justify-between text-gray-300"><span>Average</span><span><%= quantity.avg.toFixed(2) %></span></li>
        <li class="flex justify-between text-green-400"><span>P&L at Max Qty</span><span><%= currencySymbol %><%= quantity.pnlMax %></span></li>
        <li class="flex justify-between text-green-400"><span>P&L at Min Qty</span><span><%= currencySymbol %><%= quantity.pnlMin %></span></li>
      </ul>
    </div>

    <!-- Weekday Avg R:R -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Weekday Avg R:R</h3>
        <div class="bg-blue-600 p-2 rounded-xl"><i class="fas fa-chart-line"></i></div>
      </div>
      <ul class="text-sm space-y-1 text-red-400">
        <% Object.keys(weekdayStats).forEach(day => { %>
          <li class="flex justify-between">
            <span><%= day %></span>
            <span><%= (weekdayStats[day].rr / (weekdayStats[day].rrCount || 1)).toFixed(2) %>R</span>
          </li>
        <% }) %>
      </ul>
    </div>

    <!-- Weekday Win Rate -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Weekday Win Rate</h3>
        <div class="bg-blue-600 p-2 rounded-xl"><i class="fas fa-calendar-day"></i></div>
      </div>
      <ul class="text-sm space-y-1 text-green-400">
        <% Object.keys(weekdayStats).forEach(day => { %>
          <li class="flex justify-between">
            <span><%= day %></span>
            <span><%= ((weekdayStats[day].wins / weekdayStats[day].total) * 100).toFixed(1) %>%</span>
          </li>
        <% }) %>
      </ul>
    </div>

    <!-- Daily Trade Activity -->
    <div class="bg-[#1f2937] rounded-2xl p-6 shadow-xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Daily Trade Activity</h3>
        <div class="bg-purple-600 p-2 rounded-xl"><i class="fas fa-clock"></i></div>
      </div>
      <ul class="text-sm space-y-1 text-gray-300">
        <li class="flex justify-between"><span>Avg Trades Per Day</span><span><%= dailyActivity.avgTradesPerDay.toFixed(2) %></span></li>
        <li class="flex justify-between"><span>Max Trades in a Day</span><span><%= dailyActivity.maxTradesInADay %></span></li>
        <li class="flex justify-between"><span>Days With Only 1 Trade</span><span><%= dailyActivity.oneTradeDays %></span></li>
        <li class="flex justify-between text-red-400"><span>Overtrading Days (&gt;7 trades)</span><span><%= dailyActivity.overtradeDays %></span></li>
      </ul>
    </div>

  </div>
</div>

<%- include('../include/footer') %>
